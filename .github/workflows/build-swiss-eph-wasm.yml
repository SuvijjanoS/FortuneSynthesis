- name: Clone & build Swiss-Eph to WASM
  run: |
    # 1. Clone Swiss Ephemeris C source
    git clone https://github.com/aloistr/swisseph.git swisseph

    # 2. Install & activate Emscripten SDK
    git clone https://github.com/emscripten-core/emsdk.git emsdk
    cd emsdk
    ./emsdk install latest
    ./emsdk activate latest
    source ./emsdk_env.sh

    # 3. Build the C sources to WASM + glue
    cd ../swisseph
    emcc -std=c99 -O3 -s STANDALONE_WASM \
         -s EXPORTED_FUNCTIONS='["_swe_julday","_swe_calc_ut","_swe_set_ephe_path"]' \
         -s EXPORTED_RUNTIME_METHODS='["cwrap","ccall"]' \
         *.c \
         -o swe_wasm.js

    # 4. Move artifacts
    mkdir -p ../lib/swiss-ephem
    mv swe_wasm.js  ../lib/swiss-ephem/
    mv swe_wasm.wasm ../lib/swiss-ephem/
